name: 🤖 SmartAgent Android Build

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  build:
    name: 📱 Build Android APK
    runs-on: ubuntu-latest
    
    # Virtual Environment Setup
    container:
      image: ubuntu:22.04
    
    steps:
    - name: 📥 Checkout Repository
      uses: actions/checkout@v4
      
    - name: 🔧 Setup Virtual Environment
      run: |
        apt-get update && apt-get install -y \
          openjdk-17-jdk \
          wget \
          unzip \
          curl \
          build-essential
        
    - name: 📦 Setup Android SDK (Virtual)
      run: |
        export ANDROID_SDK_ROOT=/opt/android-sdk
        mkdir -p $ANDROID_SDK_ROOT/cmdline-tools
        wget -q https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip -O cmdline-tools.zip
        unzip cmdline-tools.zip -d $ANDROID_SDK_ROOT/cmdline-tools
        mv $ANDROID_SDK_ROOT/cmdline-tools/cmdline-tools $ANDROID_SDK_ROOT/cmdline-tools/latest
        export PATH=$ANDROID_SDK_ROOT/cmdline-tools/latest/bin:$PATH
        yes | sdkmanager --licenses || true
        sdkmanager "platform-tools" "platforms;android-33" "build-tools;33.0.0"
        
    - name: 🏗️ Build with Gradle (Virtual Environment)
      run: |
        cd android_app
        export ANDROID_SDK_ROOT=/opt/android-sdk
        export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
        export PATH=$ANDROID_SDK_ROOT/cmdline-tools/latest/bin:$ANDROID_SDK_ROOT/platform-tools:$PATH
        chmod +x gradlew
        ./gradlew assembleDebug --stacktrace
        
    - name: 📤 Upload APK Artifact
      uses: actions/upload-artifact@v4
      with:
        name: SmartAgent-APK
        path: android_app/app/build/outputs/apk/debug/*.apk
        retention-days: 30
        
    - name: 📝 APK Information
      run: |
        echo "🎉 Build Successful!"
        echo "📱 APK Location: android_app/app/build/outputs/apk/debug/"
        echo "💾 Download from Actions artifacts tab"
        echo "🚀 SmartAgent ready for deployment!"
